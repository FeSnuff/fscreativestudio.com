<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tours App</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; }
        #app { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwAOTSKw3rxOu_VyCPmpnXurDApQEiYjwfynkyyOeo8k6g1INY5aRsFruYVXzAsidBB9A/exec';
        let USER = null;

        async function loadView(viewName) {
            const response = await fetch(`components/${viewName}.html`);
            const html = await response.text();
            document.getElementById('app').innerHTML = html;
            
            const scripts = document.getElementById('app').querySelectorAll('script');
            scripts.forEach(oldScript => {
                const newScript = document.createElement('script');
                newScript.textContent = oldScript.textContent;
                oldScript.replaceWith(newScript);
            });
        }

        async function login(username, password) {
            const url = `${SCRIPT_URL}?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`;
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.success) {
                USER = username;
                localStorage.setItem('user', username);
                showSuccess();
            } else {
                throw new Error(data.message || 'Usuario o contraseña incorrectos');
            }
        }

        function showSuccess() {
            document.getElementById('app').innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center;">
                    <div style="background: white; padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <h1 style="color: #333; margin-bottom: 20px;">✅ Login Exitoso</h1>
                        <p style="font-size: 18px; color: #666;">Bienvenido, <strong>${USER}</strong></p>
                        <button onclick="logout()" style="margin-top: 20px; padding: 12px 30px; background: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">Cerrar Sesión</button>
                    </div>
                </div>
            `;
        }

        function logout() {
            localStorage.removeItem('user');
            location.reload();
        }

        async function init() {
            USER = localStorage.getItem('user');
            
            if (USER) {
                showSuccess();
            } else {
                await loadView('login');
            }
        }

        window.onload = init;
    </script>
</body>
</html>
