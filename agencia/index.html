<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tours App</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; }
        #app { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwAOTSKw3rxOu_VyCPmpnXurDApQEiYjwfynkyyOeo8k6g1INY5aRsFruYVXzAsidBB9A/exec';
        let USER = null;
        let TOURS = [];
        let CART = [];

        async function loadView(viewName) {
            const response = await fetch(`components/${viewName}.html`);
            const html = await response.text();
            document.getElementById('app').innerHTML = html;
            
            const scripts = document.getElementById('app').querySelectorAll('script');
            scripts.forEach(oldScript => {
                const newScript = document.createElement('script');
                newScript.textContent = oldScript.textContent;
                oldScript.replaceWith(newScript);
            });
        }

        async function login(username, password) {
            const url = `${SCRIPT_URL}?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`;
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.success) {
                USER = username;
                localStorage.setItem('user', username);
                await loadTours();
                await showSuccess();
            } else {
                throw new Error(data.message || 'Usuario o contraseÃ±a incorrectos');
            }
        }

        async function loadTours() {
            try {
                const response = await fetch('tours.json');
                TOURS = await response.json();
            } catch (e) {
                TOURS = [];
            }
        }

        function addToCart(index) {
            const exists = CART.findIndex(item => item.index === index);
            if (exists !== -1) {
                CART.splice(exists, 1);
            } else {
                CART.push({ index, ...TOURS[index] });
            }
            renderTours();
            updateCart();
        }

        async function goToVista1() {
            await loadView('vista1');
        }

        async function showSuccess() {
            await loadView('vistatours');
        }

        function logout() {
            localStorage.removeItem('user');
            location.reload();
        }

        async function init() {
            USER = localStorage.getItem('user');
            
            if (USER) {
                await loadTours();
                await showSuccess();
            } else {
                await loadView('login');
            }
        }

        window.onload = init;
    </script>
</body>
</html>
