<style>
.tours-view { max-width: 1600px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 1fr 350px; gap: 30px; }
.btn-logout-top { position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; z-index: 10; }
.tours-header { grid-column: 1/-1; color: #fff; font-size: 32px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
.user-welcome { color: #fff; font-size: 18px; }
.filters { grid-column: 1/-1; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 15px; }
.filter-group { display: flex; flex-direction: column; gap: 5px; }
.filter-group label { font-weight: 600; font-size: 14px; }
.filter-group input, .filter-group select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
.tours-section { grid-column: 1; }
.tours-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
.tour-card { background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s; }
.tour-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
.tour-card.selected { border: 3px solid #667eea; }
.tour-image { position: relative; height: 180px; background: linear-gradient(135deg, #667eea, #764ba2); overflow: hidden; }
.tour-image .overlay { position: absolute; inset: 0; background: rgba(102,126,234,0.9); display: flex; align-items: center; justify-content: center; font-size: 60px; color: #fff; opacity: 0; transition: opacity 0.3s; }
.tour-card:hover .overlay { opacity: 1; }
.tour-image .badge { position: absolute; top: 10px; left: 10px; width: 30px; height: 30px; border-radius: 50%; background: #667eea; color: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; opacity: 0; }
.tour-card.selected .badge { opacity: 1; }
.tour-info { padding: 15px; }
.tour-info h3 { font-size: 16px; margin-bottom: 8px; color: #333; min-height: 40px; }
.tour-info p { color: #666; font-size: 14px; margin: 4px 0; }
.tour-info .price { color: #667eea; font-weight: bold; font-size: 18px; margin-top: 8px; }
.cart-sidebar { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); height: fit-content; position: sticky; top: 100px; display: flex; flex-direction: column; max-height: calc(100vh - 120px); }
.cart-header { padding: 20px; border-bottom: 2px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; }
.cart-header h3 { font-size: 18px; display: flex; align-items: center; gap: 8px; }
.cart-badge { width: 28px; height: 28px; border-radius: 50%; background: #667eea; color: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; }
.cart-content { flex: 1; overflow-y: auto; padding: 20px; }
.empty-cart { text-align: center; padding: 40px 20px; color: #999; }
.empty-cart div { font-size: 50px; margin-bottom: 10px; }
.cart-item { background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
.cart-item-info { display: flex; align-items: center; gap: 10px; }
.cart-item-num { width: 28px; height: 28px; border-radius: 50%; background: #667eea; color: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; }
.cart-item-details { }
.cart-item-name { font-weight: 600; font-size: 14px; }
.cart-item-price { color: #667eea; font-weight: 600; }
.btn-remove { border: none; background: #dc3545; color: #fff; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 16px; }
.cart-footer { padding: 20px; border-top: 2px solid #e0e0e0; }
.cart-total { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: 600; font-size: 18px; }
.cart-total span:last-child { color: #667eea; font-size: 22px; }
.btn-continue { width: 100%; padding: 14px; border: none; border-radius: 8px; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; }
.btn-continue:disabled { opacity: 0.5; cursor: not-allowed; }
@media (max-width: 1024px) {
    .tours-view { grid-template-columns: 1fr; }
    .cart-sidebar { display: none; }
    .filters { grid-template-columns: 1fr; }
}
</style>

<button class="btn-logout-top" onclick="logout()">Cerrar Sesi√≥n</button>

<div class="tours-view">
    <div class="tours-header">
        <div>üó∫Ô∏è Tours Disponibles</div>
        <div class="user-welcome">Hola, <span id="userName"></span></div>
    </div>
    
    <div class="filters">
        <div class="filter-group">
            <label>üîç Buscar</label>
            <input type="text" id="searchFilter" placeholder="Buscar tours...">
        </div>
        <div class="filter-group">
            <label>Ordenar</label>
            <select id="sortFilter">
                <option value="name">Nombre A-Z</option>
                <option value="price-asc">Precio: Menor</option>
                <option value="price-desc">Precio: Mayor</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Duraci√≥n</label>
            <select id="durationFilter">
                <option value="all">Todas</option>
                <option value="1">1 d√≠a</option>
                <option value="2">2 d√≠as</option>
                <option value="3">3 d√≠as</option>
                <option value="4">4+ d√≠as</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Precio</label>
            <select id="priceFilter">
                <option value="all">Todos</option>
                <option value="0-100">S/ 0-100</option>
                <option value="100-200">S/ 100-200</option>
                <option value="200+">S/ 200+</option>
            </select>
        </div>
    </div>
    
    <div class="tours-section">
        <div class="tours-grid" id="toursGrid"></div>
    </div>
    
    <div class="cart-sidebar">
        <div class="cart-header">
            <h3>üõí Mi Itinerario</h3>
            <div class="cart-badge" id="cartBadge">0</div>
        </div>
        <div class="cart-content" id="cartContent">
            <div class="empty-cart">
                <div>üìã</div>
                <p>No hay tours seleccionados</p>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>TOTAL:</span>
                <span id="cartTotal">S/ 0.00</span>
            </div>
            <button class="btn-continue" id="btnContinue" onclick="goToVista1()">Ver Itinerario ‚Üí</button>
        </div>
    </div>
</div>

<script>
document.getElementById('userName').textContent = USER;
renderTours();
updateCart();

document.getElementById('searchFilter').addEventListener('input', filterTours);
document.getElementById('sortFilter').addEventListener('change', filterTours);
document.getElementById('durationFilter').addEventListener('change', filterTours);
document.getElementById('priceFilter').addEventListener('change', filterTours);

function renderTours() {
    const grid = document.getElementById('toursGrid');
    if (!grid) return;
    
    grid.innerHTML = TOURS.map((tour, i) => {
        const selected = CART.some(item => item.index === i);
        const cartIndex = selected ? CART.findIndex(item => item.index === i) + 1 : '';
        return `
            <div class="tour-card ${selected ? 'selected' : ''}" onclick="addToCart(${i})">
                <div class="tour-image">
                    <span class="badge">${cartIndex}</span>
                    <div class="overlay">+</div>
                </div>
                <div class="tour-info">
                    <h3>${tour.name}</h3>
                    <p>üìÖ ${tour.duration_days} d√≠a${tour.duration_days > 1 ? 's' : ''}</p>
                    <p class="price">S/ ${tour.price.toFixed(2)}</p>
                </div>
            </div>
        `;
    }).join('');
}

function updateCart() {
    const badge = document.getElementById('cartBadge');
    const total = document.getElementById('cartTotal');
    const content = document.getElementById('cartContent');
    const btn = document.getElementById('btnContinue');
    
    if (badge) badge.textContent = CART.length;
    if (btn) btn.disabled = CART.length === 0;
    
    const sum = CART.reduce((acc, t) => acc + t.price, 0);
    if (total) total.textContent = `S/ ${sum.toFixed(2)}`;
    
    if (content) {
        if (CART.length === 0) {
            content.innerHTML = `
                <div class="empty-cart">
                    <div>üìã</div>
                    <p>No hay tours seleccionados</p>
                </div>
            `;
        } else {
            content.innerHTML = CART.map((t, i) => `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <div class="cart-item-num">${i + 1}</div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${t.name}</div>
                            <div class="cart-item-price">S/ ${t.price.toFixed(2)}</div>
                        </div>
                    </div>
                    <button class="btn-remove" onclick="addToCart(${t.index})">√ó</button>
                </div>
            `).join('');
        }
    }
}

function filterTours() {
    const search = document.getElementById('searchFilter').value.toLowerCase();
    const sort = document.getElementById('sortFilter').value;
    const duration = document.getElementById('durationFilter').value;
    const price = document.getElementById('priceFilter').value;
    
    let filtered = [...TOURS];
    
    if (search) {
        filtered = filtered.filter(t => t.name.toLowerCase().includes(search));
    }
    
    if (duration !== 'all') {
        const d = parseInt(duration);
        filtered = filtered.filter(t => duration === '4' ? t.duration_days >= 4 : t.duration_days === d);
    }
    
    if (price !== 'all') {
        const [min, max] = price.split('-').map(p => p === '+' ? Infinity : parseInt(p));
        filtered = filtered.filter(t => t.price >= min && t.price <= (max || Infinity));
    }
    
    if (sort === 'price-asc') filtered.sort((a, b) => a.price - b.price);
    if (sort === 'price-desc') filtered.sort((a, b) => b.price - a.price);
    if (sort === 'name') filtered.sort((a, b) => a.name.localeCompare(b.name));
    
    TOURS = filtered;
    renderTours();
}
</script>
