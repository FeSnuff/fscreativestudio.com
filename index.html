<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tours & Aventuras</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        #app { min-height: 100vh; display: flex; flex-direction: column; }
        #main-content { flex: 1; }
    </style>
</head>
<body>
    <div id="app">
        <div id="navbar-container"></div>
        <main id="main-content"></main>
        <div id="footer-container"></div>
    </div>

    <script>
        class ToursApp {
            constructor() {
                this.config = null;
                this.user = null;
                this.init();
            }
            
            async init() {
                console.log('ðŸš€ Iniciando app...');
                
                await this.loadConfig();
                await this.loadComponent('navbar', 'navbar-container');
                await this.loadComponent('footer', 'footer-container');
                
                this.user = localStorage.getItem('user');
                console.log('ðŸ‘¤ Usuario:', this.user);
                
                if (this.user) {
                    console.log('âœ… Ya logueado, cargando tours...');
                    this.updateNavbar();
                    await this.loadComponent('tours', 'main-content');
                } else {
                    console.log('âŒ Sin login, mostrando login...');
                    await this.loadComponent('login', 'main-content');
                }
            }
            
            async loadConfig() {
                const response = await fetch('config.json');
                this.config = await response.json();
                console.log('âš™ï¸ Config:', this.config);
            }
            
            async loadComponent(name, containerId) {
                console.log(`ðŸ“¦ Cargando ${name}...`);
                const response = await fetch(`components/${name}.html`);
                const html = await response.text();
                document.getElementById(containerId).innerHTML = html;
                
                const container = document.getElementById(containerId);
                container.querySelectorAll('script').forEach(old => {
                    const script = document.createElement('script');
                    script.textContent = old.textContent;
                    old.replaceWith(script);
                });
                console.log(`âœ… ${name} listo`);
            }
            
            async verifyLogin(username, password) {
                console.log('ðŸ” Verificando:', username);
                console.log('ðŸŒ URL:', this.config.VERIFY_URL);
                
                const url = `${this.config.VERIFY_URL}?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`;
                console.log('ðŸ”— URL completa:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                const result = await response.json();
                console.log('ðŸ“¡ Respuesta:', result);
                return result;
            }
            
            async login(username, password) {
                const result = await this.verifyLogin(username, password);
                
                if (result.success) {
                    console.log('âœ… Login OK');
                    this.user = result.name || username;
                    localStorage.setItem('user', this.user);
                    this.updateNavbar();
                    await this.loadComponent('tours', 'main-content');
                } else {
                    console.log('âŒ Login FAIL');
                    alert(result.message || 'Usuario o contraseÃ±a incorrectos');
                }
            }
            
            updateNavbar() {
                const userName = document.getElementById('userName');
                const userInitial = document.getElementById('userInitial');
                const btnLogout = document.getElementById('btnLogout');
                
                if (userName) userName.textContent = this.user;
                if (userInitial) userInitial.textContent = this.user.charAt(0).toUpperCase();
                if (btnLogout) btnLogout.style.display = 'flex';
            }
            
            logout() {
                this.user = null;
                localStorage.removeItem('user');
                location.reload();
            }
        }

        let app;
        window.addEventListener('load', () => {
            app = new ToursApp();
        });
    </script>
</body>
</html>
